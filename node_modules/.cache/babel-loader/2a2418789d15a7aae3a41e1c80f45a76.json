{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp, _initialiseProps;\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport zhCN from '../locale/zh-cn.js';\nimport { func, obj } from '../util';\nimport Base from './base';\nimport List from './list';\nimport Upload from './upload';\n/**\n * Upload.Card\n * @description 继承 Upload 的 API，除非特别说明\n */\n\nvar Card = (_temp = _class = function (_Base) {\n  _inherits(Card, _Base);\n\n  function Card(props) {\n    _classCallCheck(this, Card);\n\n    var _this = _possibleConstructorReturn(this, _Base.call(this, props));\n\n    _initialiseProps.call(_this);\n\n    var value = void 0;\n    /* istanbul ignore else */\n\n    if ('value' in props) {\n      value = props.value;\n    } else {\n      value = props.defaultValue;\n    }\n\n    _this.state = {\n      value: typeof value === 'undefined' ?\n      /* istanbul ignore next */\n      [] : value,\n      uploaderRef: _this.uploaderRef\n    };\n    return _this;\n  }\n  /* eslint react/no-did-mount-set-state: [0] */\n\n\n  Card.prototype.componentDidMount = function componentDidMount() {\n    this.setState({\n      uploaderRef: this.uploaderRef\n    });\n  };\n\n  Card.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    /* istanbul ignore if */\n    if ('value' in nextProps) {\n      this.setState({\n        value: typeof nextProps.value === 'undefined' ? [] : nextProps.value\n      });\n    }\n  };\n\n  Card.prototype.isUploading = function isUploading() {\n    return this.state.uploaderRef.isUploading();\n  };\n\n  Card.prototype.saveRef = function saveRef(ref) {\n    this.saveUploaderRef(ref);\n  };\n\n  Card.prototype.render = function render() {\n    var _classNames,\n        _this2 = this;\n\n    var _props = this.props,\n        action = _props.action,\n        disabled = _props.disabled,\n        prefix = _props.prefix,\n        locale = _props.locale,\n        className = _props.className,\n        style = _props.style,\n        limit = _props.limit,\n        onPreview = _props.onPreview,\n        onRemove = _props.onRemove,\n        onCancel = _props.onCancel,\n        timeout = _props.timeout;\n    var isExceedLimit = this.state.value.length >= limit;\n    var uploadButtonCls = classNames((_classNames = {}, _classNames[prefix + 'upload-list-item'] = true, _classNames[prefix + 'hidden'] = isExceedLimit, _classNames));\n    var children = this.props.children || locale.card.addPhoto;\n    var othersForList = obj.pickOthers(Card.propTypes, this.props);\n    var othersForUpload = obj.pickOthers(List.propTypes, othersForList);\n    return React.createElement(List, _extends({\n      className: className,\n      style: style,\n      listType: 'card',\n      closable: true,\n      locale: locale,\n      value: this.state.value,\n      onRemove: onRemove,\n      onCancel: onCancel,\n      onPreview: onPreview,\n      uploader: this.state.uploaderRef\n    }, othersForList), React.createElement(Upload, _extends({}, othersForUpload, {\n      shape: 'card',\n      disabled: disabled || isExceedLimit,\n      action: action,\n      timeout: timeout,\n      value: this.state.value,\n      onProgress: this.onProgress,\n      onChange: this.onChange,\n      ref: function ref(_ref) {\n        return _this2.saveRef(_ref);\n      },\n      className: uploadButtonCls\n    }), children));\n  };\n\n  return Card;\n}(Base), _class.displayName = 'Card', _class.propTypes = {\n  prefix: PropTypes.string,\n  locale: PropTypes.object,\n  children: PropTypes.object,\n  value: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n  defaultValue: PropTypes.oneOfType([PropTypes.array, PropTypes.object]),\n\n  /**\n   * 点击图片回调\n   */\n  onPreview: PropTypes.func,\n\n  /**\n   * 改变时候的回调\n   */\n  onChange: PropTypes.func,\n\n  /**\n   * 点击移除的回调\n   */\n  onRemove: PropTypes.func,\n\n  /**\n   * 取消上传的回调\n   */\n  onCancel: PropTypes.func\n}, _class.defaultProps = {\n  prefix: 'next-',\n  locale: zhCN.Upload,\n  onChange: func.noop,\n  onPreview: func.noop\n}, _initialiseProps = function _initialiseProps() {\n  var _this3 = this;\n\n  this.onProgress = function (value) {\n    _this3.setState({\n      value: value\n    });\n  };\n\n  this.onChange = function (value, file) {\n    if (!('value' in _this3.props)) {\n      _this3.setState({\n        value: value\n      });\n    }\n\n    _this3.props.onChange(value, file);\n  };\n}, _temp);\nexport default Card;","map":null,"metadata":{},"sourceType":"module"}