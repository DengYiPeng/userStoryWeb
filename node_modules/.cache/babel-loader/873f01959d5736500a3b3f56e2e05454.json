{"ast":null,"code":"import _typeof from 'babel-runtime/helpers/typeof';\nimport _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp, _initialiseProps;\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport moment from 'moment';\nimport Overlay from '../overlay';\nimport Input from '../input';\nimport Calendar from '../calendar';\nimport TimePickerPanel from '../time-picker/panel';\nimport nextLocale from '../locale/zh-cn';\nimport { func, obj } from '../util';\nimport { PANEL, resetValueTime, checkDateValue, formatDateValue, getDateTimeFormat, extend } from './util';\nimport PanelFooter from './module/panel-footer';\nvar Popup = Overlay.Popup;\n/**\n * DatePicker\n */\n\nvar DatePicker = (_temp = _class = function (_Component) {\n  _inherits(DatePicker, _Component);\n\n  function DatePicker(props, context) {\n    _classCallCheck(this, DatePicker);\n\n    var _this = _possibleConstructorReturn(this, _Component.call(this, props, context));\n\n    _initialiseProps.call(_this);\n\n    var dateTimeFormat = getDateTimeFormat(props.format, props.showTime);\n    extend(dateTimeFormat, _this);\n    var value = formatDateValue(props.value || props.defaultValue, _this.dateTimeFormat);\n    _this.inputAsString = typeof (props.value || props.defaultValue) === 'string'; // 判断用户输入是否是字符串\n\n    _this.state = {\n      value: value,\n      dateInputStr: '',\n      timeInputStr: '',\n      inputing: false,\n      // 当前是否处于输入状态\n      visible: props.visible || props.defaultVisible,\n      panel: PANEL.DATE\n    };\n    return _this;\n  }\n\n  DatePicker.prototype.componentWillReceiveProps = function componentWillReceiveProps(nextProps) {\n    if ('showTime' in nextProps) {\n      var dateTimeFormat = getDateTimeFormat(nextProps.format || this.props.format, nextProps.showTime);\n      extend(dateTimeFormat, this);\n    }\n\n    if ('value' in nextProps) {\n      var value = formatDateValue(nextProps.value, this.dateTimeFormat);\n      this.setState({\n        value: value\n      });\n      this.inputAsString = typeof nextProps.value === 'string';\n    }\n\n    if ('visible' in nextProps) {\n      this.setState({\n        visible: nextProps.visible\n      });\n    }\n  };\n\n  DatePicker.prototype.render = function render() {\n    var _classnames, _classnames2, _classnames3, _classnames4, _PANEL$DATE$PANEL$TIM;\n\n    var _props = this.props,\n        prefix = _props.prefix,\n        rtl = _props.rtl,\n        locale = _props.locale,\n        label = _props.label,\n        state = _props.state,\n        defaultVisibleMonth = _props.defaultVisibleMonth,\n        onVisibleMonthChange = _props.onVisibleMonthChange,\n        showTime = _props.showTime,\n        disabledDate = _props.disabledDate,\n        footerRender = _props.footerRender,\n        placeholder = _props.placeholder,\n        size = _props.size,\n        disabled = _props.disabled,\n        hasClear = _props.hasClear,\n        popupTriggerType = _props.popupTriggerType,\n        popupAlign = _props.popupAlign,\n        popupContainer = _props.popupContainer,\n        popupStyle = _props.popupStyle,\n        popupClassName = _props.popupClassName,\n        popupProps = _props.popupProps,\n        className = _props.className,\n        others = _objectWithoutProperties(_props, ['prefix', 'rtl', 'locale', 'label', 'state', 'defaultVisibleMonth', 'onVisibleMonthChange', 'showTime', 'disabledDate', 'footerRender', 'placeholder', 'size', 'disabled', 'hasClear', 'popupTriggerType', 'popupAlign', 'popupContainer', 'popupStyle', 'popupClassName', 'popupProps', 'className']);\n\n    var _state = this.state,\n        visible = _state.visible,\n        value = _state.value,\n        dateInputStr = _state.dateInputStr,\n        timeInputStr = _state.timeInputStr,\n        panel = _state.panel,\n        inputing = _state.inputing;\n    var datePickerCls = classnames((_classnames = {}, _classnames[prefix + 'date-picker'] = true, _classnames), className);\n    var triggerInputCls = classnames((_classnames2 = {}, _classnames2[prefix + 'date-picker-input'] = true, _classnames2[prefix + 'error'] = false, _classnames2));\n    var panelBodyClassName = classnames((_classnames3 = {}, _classnames3[prefix + 'date-picker-body'] = true, _classnames3[prefix + 'date-picker-body-show-time'] = showTime, _classnames3));\n    var panelDateInputCls = classnames((_classnames4 = {}, _classnames4[prefix + 'date-picker-panel-input'] = true, _classnames4[prefix + 'focus'] = panel === PANEL.DATE, _classnames4));\n\n    if (rtl) {\n      others.dir = 'rtl';\n    }\n\n    var sharedInputProps = {\n      size: size,\n      disabled: disabled,\n      onChange: this.onDateInputChange,\n      onBlur: this.onDateInputBlur,\n      onPressEnter: this.onDateInputBlur\n    };\n    var dateInputValue = inputing === 'date' ? dateInputStr : value && value.format(this.format) || '';\n    var triggerInputValue = dateInputValue;\n    var dateInput = React.createElement(Input, _extends({}, sharedInputProps, {\n      value: dateInputValue,\n      onFocus: this.onFoucsDateInput,\n      placeholder: this.format,\n      className: panelDateInputCls\n    }));\n    var datePanel = React.createElement(Calendar, {\n      shape: 'panel',\n      value: value,\n      format: this.format,\n      onSelect: this.onSelectCalendarPanel,\n      defaultVisibleMonth: defaultVisibleMonth,\n      onVisibleMonthChange: onVisibleMonthChange,\n      disabledDate: disabledDate\n    });\n    var panelFooter = footerRender();\n    var timeInput = null;\n    var timePanel = null;\n\n    if (showTime) {\n      var _classnames5;\n\n      var timeInputValue = inputing === 'time' ? timeInputStr : value && value.format(this.timeFormat) || '';\n      triggerInputValue = value && value.format(this.dateTimeFormat) || '';\n      var timePanelProps = (typeof showTime === 'undefined' ? 'undefined' : _typeof(showTime)) === 'object' ? showTime : {};\n      var showSecond = this.timeFormat.indexOf('s') > -1;\n      var panelTimeInputCls = classnames((_classnames5 = {}, _classnames5[prefix + 'date-picker-panel-input'] = true, _classnames5[prefix + 'focus'] = panel === PANEL.TIME, _classnames5));\n      timeInput = React.createElement(Input, {\n        placeholder: this.timeFormat,\n        value: timeInputValue,\n        size: size,\n        disabled: disabled || !value,\n        onChange: this.onTimeInputChange,\n        onFocus: this.onFoucsTimeInput,\n        onBlur: this.onTimeInputBlur,\n        onPressEnter: this.onTimeInputBlur,\n        className: panelTimeInputCls\n      });\n      timePanel = React.createElement(TimePickerPanel, _extends({}, timePanelProps, {\n        locale: locale,\n        className: prefix + 'date-picker-panel-time',\n        showSecond: showSecond,\n        disabled: disabled,\n        prefix: prefix,\n        value: value,\n        onSelect: this.onSelectTimePanel\n      }));\n      panelFooter = panelFooter || React.createElement(PanelFooter, {\n        prefix: prefix,\n        locale: locale,\n        value: value,\n        panel: panel,\n        onPanelChange: this.changePanel,\n        onOk: this.onOk\n      });\n    }\n\n    var panelBody = (_PANEL$DATE$PANEL$TIM = {}, _PANEL$DATE$PANEL$TIM[PANEL.DATE] = datePanel, _PANEL$DATE$PANEL$TIM[PANEL.TIME] = timePanel, _PANEL$DATE$PANEL$TIM)[panel];\n    var allowClear = value && hasClear;\n    var trigger = React.createElement('div', {\n      className: prefix + 'date-picker-trigger'\n    }, React.createElement(Input, _extends({}, sharedInputProps, {\n      label: label,\n      state: state,\n      value: triggerInputValue,\n      placeholder: placeholder || (showTime ? locale.datetimePlaceholder : locale.placeholder),\n      hint: 'calendar',\n      hasClear: allowClear,\n      className: triggerInputCls\n    })));\n    return React.createElement('div', _extends({}, obj.pickOthers(DatePicker.propTypes, others), {\n      className: datePickerCls\n    }), React.createElement(Popup, _extends({}, popupProps, {\n      disabled: disabled,\n      visible: visible,\n      onVisibleChange: this.onVisibleChange,\n      align: popupAlign,\n      triggerType: popupTriggerType,\n      container: popupContainer,\n      style: popupStyle,\n      className: popupClassName,\n      trigger: trigger\n    }), React.createElement('div', {\n      dir: others.dir,\n      className: panelBodyClassName\n    }, React.createElement('div', {\n      className: prefix + 'date-picker-panel-header'\n    }, dateInput, timeInput), panelBody, panelFooter)));\n  };\n\n  return DatePicker;\n}(Component), _class.propTypes = {\n  prefix: PropTypes.string,\n  rtl: PropTypes.bool,\n\n  /**\n   * 输入框内置标签\n   */\n  label: PropTypes.node,\n\n  /**\n   * 输入框状态\n   */\n  state: PropTypes.oneOf(['success', 'error']),\n\n  /**\n   * 输入提示\n   */\n  placeholder: PropTypes.string,\n\n  /**\n   * 默认展现的月\n   * @return {MomentObject} 返回包含指定月份的 moment 对象实例\n   */\n  defaultVisibleMonth: PropTypes.func,\n  onVisibleMonthChange: PropTypes.func,\n\n  /**\n   * 日期值（受控）moment 对象\n   */\n  value: checkDateValue,\n\n  /**\n   * 初始日期值，moment 对象\n   */\n  defaultValue: checkDateValue,\n\n  /**\n   * 日期值的格式（用于限定用户输入和展示）\n   */\n  format: PropTypes.string,\n\n  /**\n   * 是否使用时间控件，传入 TimePicker 的属性 { defaultValue, format, ... }\n   */\n  showTime: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n\n  /**\n   * 每次选择日期时是否重置时间（仅在 showTime 开启时有效）\n   */\n  resetTime: PropTypes.bool,\n\n  /**\n   * 禁用日期函数\n   * @param {MomentObject} 日期值\n   * @return {Boolean} 是否禁用\n   */\n  disabledDate: PropTypes.func,\n\n  /**\n   * 自定义面板页脚\n   * @return {Node} 自定义的面板页脚组件\n   */\n  footerRender: PropTypes.func,\n\n  /**\n   * 日期值改变时的回调\n   * @param {MomentObject|String} value 日期值\n   */\n  onChange: PropTypes.func,\n\n  /**\n   * 点击确认按钮时的回调\n   * @return {MomentObject|String} 日期值\n   */\n  onOk: PropTypes.func,\n\n  /**\n   * 输入框尺寸\n   */\n  size: PropTypes.oneOf(['small', 'medium', 'large']),\n\n  /**\n   * 是否禁用\n   */\n  disabled: PropTypes.bool,\n\n  /**\n   * 是否显示清空按钮\n   */\n  hasClear: PropTypes.bool,\n\n  /**\n   * 弹层显示状态\n   */\n  visible: PropTypes.bool,\n\n  /**\n   * 弹层默认是否显示\n   */\n  defaultVisible: PropTypes.bool,\n\n  /**\n   * 弹层展示状态变化时的回调\n   * @param {Boolean} visible 弹层是否显示\n   * @param {String} reason 触发弹层显示和隐藏的来源\n   */\n  onVisibleChange: PropTypes.func,\n\n  /**\n   * 弹层触发方式\n   */\n  popupTriggerType: PropTypes.oneOf(['click', 'hover']),\n\n  /**\n   * 弹层对齐方式,具体含义见 OverLay文档\n   */\n  popupAlign: PropTypes.string,\n\n  /**\n   * 弹层容器\n   * @param {Element} target 目标元素\n   * @return {Element} 弹层的容器元素\n   */\n  popupContainer: PropTypes.func,\n\n  /**\n   * 弹层自定义样式\n   */\n  popupStyle: PropTypes.object,\n\n  /**\n   * 弹层自定义样式类\n   */\n  popupClassName: PropTypes.string,\n\n  /**\n   * 弹层其他属性\n   */\n  popupProps: PropTypes.object,\n  locale: PropTypes.object,\n  className: PropTypes.string\n}, _class.defaultProps = {\n  prefix: 'next-',\n  rtl: false,\n  format: 'YYYY-MM-DD',\n  size: 'medium',\n  showTime: false,\n  resetTime: false,\n  disabledDate: function disabledDate() {\n    return false;\n  },\n  footerRender: function footerRender() {\n    return null;\n  },\n  hasClear: true,\n  popupTriggerType: 'click',\n  popupAlign: 'tl tl',\n  locale: nextLocale.DatePicker,\n  onChange: func.noop,\n  onVisibleChange: func.noop,\n  onOk: func.noop\n}, _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  this.onValueChange = function (newValue) {\n    var handler = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'onChange';\n    var ret = _this2.inputAsString && newValue ? newValue.format(_this2.dateTimeFormat) : newValue;\n\n    _this2.props[handler](ret);\n  };\n\n  this.onSelectCalendarPanel = function (value) {\n    var _props2 = _this2.props,\n        showTime = _props2.showTime,\n        resetTime = _props2.resetTime;\n    var prevValue = _this2.state.value;\n    var newValue = value;\n\n    if (showTime) {\n      if (!prevValue) {\n        // 第一次选择日期值时，如果设置了默认时间，则使用该默认时间\n        if (showTime.defaultValue) {\n          var defaultTimeValue = formatDateValue(showTime.defaultValue, _this2.timeFormat);\n          newValue = resetValueTime(value, defaultTimeValue);\n        }\n      } else if (!resetTime) {\n        // 非第一选择日期，如果开启了 resetTime 属性，则记住之前选择的时间值\n        newValue = resetValueTime(value, prevValue);\n      }\n    }\n\n    _this2.handleChange(newValue, prevValue, {\n      inputing: false\n    });\n\n    if (!showTime) {\n      _this2.onVisibleChange(false, 'calendarSelect');\n    }\n  };\n\n  this.onSelectTimePanel = function (value) {\n    _this2.handleChange(value, _this2.state.value, {\n      inputing: false\n    });\n  };\n\n  this.clearValue = function () {\n    _this2.setState({\n      dateInputStr: '',\n      timeInputStr: ''\n    });\n\n    _this2.handleChange(null, _this2.state.value, {\n      inputing: false\n    });\n  };\n\n  this.onDateInputChange = function (inputStr, e, eventType) {\n    if (eventType === 'clear' || !inputStr) {\n      e.stopPropagation();\n\n      _this2.clearValue();\n    } else {\n      _this2.setState({\n        dateInputStr: inputStr,\n        inputing: 'date'\n      });\n    }\n  };\n\n  this.onTimeInputChange = function (inputStr) {\n    _this2.setState({\n      timeInputStr: inputStr,\n      inputing: 'time'\n    });\n  };\n\n  this.onDateInputBlur = function () {\n    var dateInputStr = _this2.state.dateInputStr;\n\n    if (dateInputStr) {\n      var disabledDate = _this2.props.disabledDate;\n      var parsed = moment(dateInputStr, _this2.format, true);\n\n      _this2.setState({\n        dateInputStr: '',\n        inputing: false\n      });\n\n      if (parsed.isValid() && !disabledDate(parsed)) {\n        _this2.handleChange(parsed, _this2.state.value);\n      }\n    }\n  };\n\n  this.onTimeInputBlur = function () {\n    var _state2 = _this2.state,\n        value = _state2.value,\n        timeInputStr = _state2.timeInputStr;\n\n    if (timeInputStr) {\n      var parsed = moment(timeInputStr, _this2.timeFormat, true);\n\n      _this2.setState({\n        timeInputStr: '',\n        inputing: false\n      });\n\n      if (parsed.isValid()) {\n        var hour = parsed.hour();\n        var minute = parsed.minute();\n        var second = parsed.second();\n        var newValue = value.clone().hour(hour).minute(minute).second(second);\n\n        _this2.handleChange(newValue, _this2.state.value);\n      }\n    }\n  };\n\n  this.handleChange = function (newValue, prevValue) {\n    var others = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (!('value' in _this2.props)) {\n      _this2.setState(_extends({\n        value: newValue\n      }, others));\n    }\n\n    var newValueOf = newValue ? newValue.valueOf() : null;\n    var preValueOf = prevValue ? prevValue.valueOf() : null;\n\n    if (newValueOf !== preValueOf) {\n      _this2.onValueChange(newValue);\n    }\n  };\n\n  this.onFoucsDateInput = function () {\n    if (_this2.state.panel !== PANEL.DATE) {\n      _this2.setState({\n        panel: PANEL.DATE\n      });\n    }\n  };\n\n  this.onFoucsTimeInput = function () {\n    if (_this2.state.panel !== PANEL.TIME) {\n      _this2.setState({\n        panel: PANEL.TIME\n      });\n    }\n  };\n\n  this.onVisibleChange = function (visible, reason) {\n    if (!('visible' in _this2.props)) {\n      _this2.setState({\n        visible: visible\n      });\n    }\n\n    _this2.props.onVisibleChange(visible, reason);\n  };\n\n  this.changePanel = function (panel) {\n    _this2.setState({\n      panel: panel\n    });\n  };\n\n  this.onOk = function () {\n    _this2.onVisibleChange(false, 'okBtnClick');\n\n    _this2.onValueChange(_this2.state.value, 'onOk');\n  };\n}, _temp);\nDatePicker.displayName = 'DatePicker';\nexport { DatePicker as default };","map":null,"metadata":{},"sourceType":"module"}